# yamdb_final
yamdb_final
![example workflow](https://github.com/vatut007/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)
# Работает по адресу:
51.250.109.127
http://51.250.109.127/admin/
http://51.250.109.127/redoc/
# Установка
## Требования
Регистрация на dockerhub <br />
Настроенный SSH доступ к серверу по ключу с паролем <br />
Регистрация на GitHub <br />
Выделенный сервер Linux Ubuntu 20.04 с с публичным IP адресом <br />
Настройка GitHub Secrets <br />
Клонируйте репозиторий и настройте переменные GitHub secrets согласно Вашему окружению <br />

DOCKER_PASSWORD <br />
DOCKER_USERNAME <br />
SERVER_HOST #публичный адрес сервера для доступа по SSH<br />
SERVER_SUDO_USER  <br />
SSH_KEY #Скопируйте приватный ключ с компьютера, имеющего доступ к боевому серверу: cat ~/.ssh/id_rsa <br />
SSH_PASSWORD <br />
TELEGRAM_TOKEN #токен чат бота который будет отправлять сообщение <br />
TELEGRAM_CHAT_ID #кому отправлять сообщение <br />
DB_ENGINE пример django.db.backends.postgresql <br />
DB_NAME #имя образа docker-compose с базой - db <br />
DB_POSTGRES_USER <br />
DB_POSTGRES_PASSWORD <br />
DB_HOST <br />
DB_PORT <br />
# Установка на выделенном сервере
На боевом сервере установите docker и docker-compose Остановите службу nginx Скопируйте файлы из директории infra в домашную папку пользователя <br /> docker-compose.yaml nginx - сохраняя стурктуру и название папок <br />

Deploy автоматически при команде git push <br />
при git pus запускается скрипт GitHub actions который выполняет автоматический deploy на сервер <br />

# Описание проекта:
Проект YaMDb собирает отзывы пользователей на различные художественные произведения.

# Алгоритм регистрации пользователей
Пользователь отправляет POST-запрос на добавление нового пользователя с параметрами email и username на эндпоинт /api/v1/auth/signup/. YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email. Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен). При желании пользователь отправляет PATCH-запрос на эндпоинт /api/v1/users/me/ и заполняет поля в своём профайле (описание полей — в документации).

# Пользовательские роли
Аноним — может просматривать описания произведений, читать отзывы и комментарии.
Аутентифицированный пользователь (user) — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.<br />
Модератор (moderator) — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.
Администратор (admin) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.<br />
Суперюзер Django должен всегда обладать правами администратора, пользователя с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно суперюзер.
Самостоятельная регистрация новых пользователей<br />
Пользователь отправляет POST-запрос с параметрами email и username на эндпоинт /api/v1/auth/signup/. Сервис YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указанный адрес email. Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен). В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом. После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт /api/v1/users/me/ и заполнить поля в своём профайле (описание полей — в документации).<br />

# Создание пользователя администратором
Пользователя может создать администратор — через админ-зону сайта или через POST-запрос на специальный эндпоинт api/v1/users/ (описание полей запроса для этого случая — в документации). В этот момент письмо с кодом подтверждения пользователю отправлять не нужно. После этого пользователь должен самостоятельно отправить свой email и username на эндпоинт /api/v1/auth/signup/ , в ответ ему должно прийти письмо с кодом подтверждения. Далее пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен), как и при самостоятельной регистрации.<br />

Ресурсы API YaMDb<br />
Ресурс auth: аутентификация.<br />
Ресурс users: пользователи.<br />
Ресурс titles: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).<br />
Ресурс categories: категории (типы) произведений («Фильмы», «Книги», «Музыка»).<br />
Ресурс genres: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.<br />
Ресурс reviews: отзывы на произведения. Отзыв привязан к определённому произведению.<br />
Ресурс comments: комментарии к отзывам. Комментарий привязан к определённому отзыву. Каждый ресурс описан в документации Redoc: указаны эндпоинты (адреса, по которым можно сделать запрос), разрешённые типы запросов, права доступа и дополнительные параметры, если это необходимо.<br />
Authentication<br />
jwt-token<br />
Используется аутентификация с использованием JWT-токенов<br />

Security Scheme Type	API Key
Header parameter name	Bearer